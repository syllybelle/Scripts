# Application to create sites and users

The main purpose of this application is to speed up the initial study setup in Viedoc Admin, especially when many sites and users need to be added to the study. Instead of adding sites or inviting users one by one in Viedoc Admin, this application allows them to be imported from an Excel file. Import templates can be generated by the application.

### Before using the application

1. A Web API client should be set up in Viedoc Admin. The Status of the API client should be Production. The API client name appears in the invitation email to users that are invited via this application. The following scopes should be enabled for complete functionality:
	- Get site information: Required for all functionalities
	- Get User information: Required for exporting a list of users in the study
	- Create/update site: Required for creating sites from an Excel template
	- Invite Clinic user: Required for inviting users with a clinic role (Investigator, Monitor, etc.)
	- Invite Admin user: Required for inviting users with a system role (Designer, eTMF Manager, etc.), including Site Manager when creating a new site
2. In order to import sites, the following details are needed for every site to be created:
	- siteCode: Required, a unique identifier for each site
	- siteName: Required, a unique identifier for each site
	- countryCode: Required, the 2-letter ISO country code
	- timeZoneId: Required, see bottom of this document for all possible timeZoneId values.
	- expectedNumberOfSubjectsScreened: Optional, may be left blank
	- expectedNumberOfSubjectsEnrolled: Optional, may be left blank
	- maximumNumberOfSubjectsScreened: Optional, may be left blank
	- isTrainingEnabled: Required, controls Demo/Training mode for the site, TRUE (demo mode active) or FALSE (demo mode not active)
	- isProductionEnabled: Required, controls Production mode for the site, TRUE (prod. mode active, requires a license) or FALSE (prod. mode not active)
	- roleSiteManager: Optional, the email address of the user to be invited as Site Manager
3. In order to import users, the following details are needed for every user to be invited:
	- email: Required, the email address to which the invite will be sent
	- roleOID: Required, the role to which the user will be invited. See bottom of this document for more information on the roleOID
	- siteGuid: Optional [^1], case-sensitive, a unique identifier for the site which can be obtained via this application by making an export
	- siteName: Optional [^1], case-sensitive, a unique identifier for the site
	- siteCode: Optional [^1], case-sensitive, a unique identifier for the site

[^1]: For the system role Site Manager and for all clinic roles, at least one of siteGuid, siteName or siteCode is required to identify the site to invite the user to. If siteGuid is provided, it will be used. Otherwise, siteCode will be used. If siteCode does not uniquely identify the site, then also siteName will be used. If no siteGuid and siteCode are provided, siteName will be used. In case you have created multiple sites with the same name and code (not possible with this program, only in Admin), then you must use the siteGuid to uniquely identify the site.

### How to use the application

Open a terminal in the directory containing site_user_app.py.

Optionally, create and activate a virtual environment:\
`python -m venv venv`
`venv\Scripts\activate.bat`

Install the dependencies:\
`pip install -r requirements.txt`

Then run the application:\
`python site_user_app.py`

Upon starting the application, the following will happen:\
1. You will be asked to select an output folder. Here, a log file and Excel files will be saved. Make sure you have write permission to this folder.\
2. You will be asked which server the application should connect to. Type the corresponding value and press Enter.\
3. You will be asked to provide the Client ID and Client Secret. These are found in Viedoc Admin.\
4. The application will now obtain a token from the Viedoc API, which is required for authentication purposes during the next steps.\
5. You will next be presented with a number of options. Type the number corresponding to the desired functionality and press Enter.\
	- 1: Get an Excel export with all study sites: This function retrieves all existing sites in the study and saves it to Excel.\
	- 2: Get an Excel export with all study users: This function retrieves all existing users in the study and saves it to Excel.\
	- 3: Create sites from Excel file: This function reads an Excel file with site information and creates the sites in Viedoc.\
	- 4: Create users from Excel file: This function reads an Excel file with user information and invites the users to the respective roles in Viedoc.\
	- 0: End this program: This selection ends the program.

### RoleOID
When inviting users via this application, a roleOID needs to be provided in the import template file in order to identify the role to which the user is to be invited.\
Valid system roles (either the RoleOID or Role name can be used):
| RoleOID               | Role name                     |
| --------------------- | ----------------------------- |
| RoleStudyManager      | Study Manager                 |
| RoleSiteManager       | Site Manager                  |
| ApiManager            | API Manager                   |
| RoleDesigner          | Designer                      |
| UnblindedStatistician | Unblinded Statistician        |
| DictionaryManager     | Dictionary Manager            |
| RefDataSourceManager  | Reference Data Source Manager |
| EtmfManager           | eTMF Manager                  |
| DesignImpactAnalyst   | Design Impact Analyst         |

Valid clinic roles: The role name as entered in Viedoc Designer, or the Role ID such as R1, R2, etc.

### TimeZoneIds

| TimeZoneID                      | Display	Name                                                  |
| ------------------------------- | ------------------------------------------------------------- |
| Dateline Standard Time          | (UTC-12:00) International Date Line West                      |
| UTC-11                          | (UTC-11:00) Coordinated Universal Time-11                     |
| Aleutian Standard Time          | (UTC-10:00) Aleutian Islands                                  |
| Hawaiian Standard Time          | (UTC-10:00) Hawaii                                            |
| Marquesas Standard Time         | (UTC-09:30) Marquesas Islands                                 |
| Alaskan Standard Time           | (UTC-09:00) Alaska                                            |
| UTC-09                          | (UTC-09:00) Coordinated Universal Time-09                     |
| Pacific Standard Time (Mexico)  | (UTC-08:00) Baja California                                   |
| UTC-08                          | (UTC-08:00) Coordinated Universal Time-08                     |
| Pacific Standard Time           | (UTC-08:00) Pacific Time (US & Canada)                        |
| US Mountain Standard Time       | (UTC-07:00) Arizona                                           |
| Mountain Standard Time (Mexico) | (UTC-07:00) La Paz, Mazatlan                                  |
| Mountain Standard Time          | (UTC-07:00) Mountain Time (US & Canada)                       |
| Yukon Standard Time             | (UTC-07:00) Yukon                                             |
| Central America Standard Time   | (UTC-06:00) Central America                                   |
| Central Standard Time           | (UTC-06:00) Central Time (US & Canada)                        |
| Easter Island Standard Time     | (UTC-06:00) Easter Island                                     |
| Central Standard Time (Mexico)  | (UTC-06:00) Guadalajara, Mexico City, Monterrey               |
| Canada Central Standard Time    | (UTC-06:00) Saskatchewan                                      |
| SA Pacific Standard Time        | (UTC-05:00) Bogota, Lima, Quito, Rio Branco                   |
| Eastern Standard Time (Mexico)  | (UTC-05:00) Chetumal                                          |
| Eastern Standard Time           | (UTC-05:00) Eastern Time (US & Canada)                        |
| Haiti Standard Time             | (UTC-05:00) Haiti                                             |
| Cuba Standard Time              | (UTC-05:00) Havana                                            |
| US Eastern Standard Time        | (UTC-05:00) Indiana (East)                                    |
| Turks And Caicos Standard Time  | (UTC-05:00) Turks and Caicos                                  |
| Paraguay Standard Time          | (UTC-04:00) Asuncion                                          |
| Atlantic Standard Time          | (UTC-04:00) Atlantic Time (Canada)                            |
| Venezuela Standard Time         | (UTC-04:00) Caracas                                           |
| Central Brazilian Standard Time | (UTC-04:00) Cuiaba                                            |
| SA Western Standard Time        | (UTC-04:00) Georgetown, La Paz, Manaus, San Juan              |
| Pacific SA Standard Time        | (UTC-04:00) Santiago                                          |
| Newfoundland Standard Time      | (UTC-03:30) Newfoundland                                      |
| Tocantins Standard Time         | (UTC-03:00) Araguaina                                         |
| E. South America Standard Time  | (UTC-03:00) Brasilia                                          |
| SA Eastern Standard Time        | (UTC-03:00) Cayenne, Fortaleza                                |
| Argentina Standard Time         | (UTC-03:00) City of Buenos Aires                              |
| Greenland Standard Time         | (UTC-03:00) Greenland                                         |
| Montevideo Standard Time        | (UTC-03:00) Montevideo                                        |
| Magallanes Standard Time        | (UTC-03:00) Punta Arenas                                      |
| Saint Pierre Standard Time      | (UTC-03:00) Saint Pierre and Miquelon                         |
| Bahia Standard Time             | (UTC-03:00) Salvador                                          |
| UTC-02                          | (UTC-02:00) Coordinated Universal Time-02                     |
| Mid-Atlantic Standard Time      | (UTC-02:00) Mid-Atlantic - Old                                |
| Azores Standard Time            | (UTC-01:00) Azores                                            |
| Cape Verde Standard Time        | (UTC-01:00) Cabo Verde Is.                                    |
| UTC                             | UTC                                                           |
| GMT Standard Time               | (UTC+00:00) Dublin, Edinburgh, Lisbon, London                 |
| Greenwich Standard Time         | (UTC+00:00) Monrovia, Reykjavik                               |
| Sao Tome Standard Time          | (UTC+00:00) Sao Tome                                          |
| Morocco Standard Time           | (UTC+01:00) Casablanca                                        |
| W. Europe Standard Time         | (UTC+01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna  |
| Central Europe Standard Time    | (UTC+01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague |
| Romance Standard Time           | (UTC+01:00) Brussels, Copenhagen, Madrid, Paris               |
| Central European Standard Time  | (UTC+01:00) Sarajevo, Skopje, Warsaw, Zagreb                  |
| W. Central Africa Standard Time | (UTC+01:00) West Central Africa                               |
| GTB Standard Time               | (UTC+02:00) Athens, Bucharest                                 |
| Middle East Standard Time       | (UTC+02:00) Beirut                                            |
| Egypt Standard Time             | (UTC+02:00) Cairo                                             |
| E. Europe Standard Time         | (UTC+02:00) Chisinau                                          |
| Syria Standard Time             | (UTC+02:00) Damascus                                          |
| West Bank Standard Time         | (UTC+02:00) Gaza, Hebron                                      |
| South Africa Standard Time      | (UTC+02:00) Harare, Pretoria                                  |
| FLE Standard Time               | (UTC+02:00) Helsinki, Kyiv, Riga, Sofia, Tallinn, Vilnius     |
| Israel Standard Time            | (UTC+02:00) Jerusalem                                         |
| South Sudan Standard Time       | (UTC+02:00) Juba                                              |
| Kaliningrad Standard Time       | (UTC+02:00) Kaliningrad                                       |
| Sudan Standard Time             | (UTC+02:00) Khartoum                                          |
| Libya Standard Time             | (UTC+02:00) Tripoli                                           |
| Namibia Standard Time           | (UTC+02:00) Windhoek                                          |
| Jordan Standard Time            | (UTC+03:00) Amman                                             |
| Arabic Standard Time            | (UTC+03:00) Baghdad                                           |
| Turkey Standard Time            | (UTC+03:00) Istanbul                                          |
| Arab Standard Time              | (UTC+03:00) Kuwait, Riyadh                                    |
| Belarus Standard Time           | (UTC+03:00) Minsk                                             |
| Russian Standard Time           | (UTC+03:00) Moscow, St. Petersburg                            |
| E. Africa Standard Time         | (UTC+03:00) Nairobi                                           |
| Volgograd Standard Time         | (UTC+03:00) Volgograd                                         |
| Iran Standard Time              | (UTC+03:30) Tehran                                            |
| Arabian Standard Time           | (UTC+04:00) Abu Dhabi, Muscat                                 |
| Astrakhan Standard Time         | (UTC+04:00) Astrakhan, Ulyanovsk                              |
| Azerbaijan Standard Time        | (UTC+04:00) Baku                                              |
| Russia Time Zone 3              | (UTC+04:00) Izhevsk, Samara                                   |
| Mauritius Standard Time         | (UTC+04:00) Port Louis                                        |
| Saratov Standard Time           | (UTC+04:00) Saratov                                           |
| Georgian Standard Time          | (UTC+04:00) Tbilisi                                           |
| Caucasus Standard Time          | (UTC+04:00) Yerevan                                           |
| Afghanistan Standard Time       | (UTC+04:30) Kabul                                             |
| West Asia Standard Time         | (UTC+05:00) Ashgabat, Tashkent                                |
| Ekaterinburg Standard Time      | (UTC+05:00) Ekaterinburg                                      |
| Pakistan Standard Time          | (UTC+05:00) Islamabad, Karachi                                |
| Qyzylorda Standard Time         | (UTC+05:00) Qyzylorda                                         |
| India Standard Time             | (UTC+05:30) Chennai, Kolkata, Mumbai, New Delhi               |
| Sri Lanka Standard Time         | (UTC+05:30) Sri Jayawardenepura                               |
| Nepal Standard Time             | (UTC+05:45) Kathmandu                                         |
| Central Asia Standard Time      | (UTC+06:00) Astana                                            |
| Bangladesh Standard Time        | (UTC+06:00) Dhaka                                             |
| Omsk Standard Time              | (UTC+06:00) Omsk                                              |
| Myanmar Standard Time           | (UTC+06:30) Yangon (Rangoon)                                  |
| SE Asia Standard Time           | (UTC+07:00) Bangkok, Hanoi, Jakarta                           |
| Altai Standard Time             | (UTC+07:00) Barnaul, Gorno-Altaysk                            |
| W. Mongolia Standard Time       | (UTC+07:00) Hovd                                              |
| North Asia Standard Time        | (UTC+07:00) Krasnoyarsk                                       |
| N. Central Asia Standard Time   | (UTC+07:00) Novosibirsk                                       |
| Tomsk Standard Time             | (UTC+07:00) Tomsk                                             |
| China Standard Time             | (UTC+08:00) Beijing, Chongqing, Hong Kong, Urumqi             |
| North Asia East Standard Time   | (UTC+08:00) Irkutsk                                           |
| Singapore Standard Time         | (UTC+08:00) Kuala Lumpur, Singapore                           |
| W. Australia Standard Time      | (UTC+08:00) Perth                                             |
| Taipei Standard Time            | (UTC+08:00) Taipei                                            |
| Ulaanbaatar Standard Time       | (UTC+08:00) Ulaanbaatar                                       |
| Aus Central W. Standard Time    | (UTC+08:45) Eucla                                             |
| Transbaikal Standard Time       | (UTC+09:00) Chita                                             |
| Tokyo Standard Time             | (UTC+09:00) Osaka, Sapporo, Tokyo                             |
| North Korea Standard Time       | (UTC+09:00) Pyongyang                                         |
| Korea Standard Time             | (UTC+09:00) Seoul                                             |
| Yakutsk Standard Time           | (UTC+09:00) Yakutsk                                           |
| Cen. Australia Standard Time    | (UTC+09:30) Adelaide                                          |
| AUS Central Standard Time       | (UTC+09:30) Darwin                                            |
| E. Australia Standard Time      | (UTC+10:00) Brisbane                                          |
| AUS Eastern Standard Time       | (UTC+10:00) Canberra, Melbourne, Sydney                       |
| West Pacific Standard Time      | (UTC+10:00) Guam, Port Moresby                                |
| Tasmania Standard Time          | (UTC+10:00) Hobart                                            |
| Vladivostok Standard Time       | (UTC+10:00) Vladivostok                                       |
| Lord Howe Standard Time         | (UTC+10:30) Lord Howe Island                                  |
| Bougainville Standard Time      | (UTC+11:00) Bougainville Island                               |
| Russia Time Zone 10             | (UTC+11:00) Chokurdakh                                        |
| Magadan Standard Time           | (UTC+11:00) Magadan                                           |
| Norfolk Standard Time           | (UTC+11:00) Norfolk Island                                    |
| Sakhalin Standard Time          | (UTC+11:00) Sakhalin                                          |
| Central Pacific Standard Time   | (UTC+11:00) Solomon Is., New Caledonia                        |
| Russia Time Zone 11             | (UTC+12:00) Anadyr, Petropavlovsk-Kamchatsky                  |
| New Zealand Standard Time       | (UTC+12:00) Auckland, Wellington                              |
| UTC+12                          | (UTC+12:00) Coordinated Universal Time+12                     |
| Fiji Standard Time              | (UTC+12:00) Fiji                                              |
| Chatham Islands Standard Time   | (UTC+12:45) Chatham Islands                                   |
| UTC+13                          | (UTC+13:00) Coordinated Universal Time+13                     |
| Tonga Standard Time             | (UTC+13:00) Nuku'alofa                                        |
| Samoa Standard Time             | (UTC+13:00) Samoa                                             |
| Line Islands Standard Time      | (UTC+14:00) Kiritimati Island                                 |

### Current limitations:
1. It is not possible to assign a design to a site using the Web API. You must do this manually in Viedoc Admin. This means that you will first create sites with this application, then go into Viedoc Admin to assign designs, and then return to this application to invite users.
2. Clinic users can be invited to sites without active design via the Web API, as long as their role exists in the study (but not necessarily at the site the user is invited to). This has no impact for the user as he/she won't be able to launch Clinic with the role.
3. Roles can be successfully assigned to users who already have the role. In that case, nothing happens, but the Web API (and therefore this application) reports success.
4. Currently, this application does not work with site groups. If users should have access to a site group (e.g. all sites in a certain country), this will need to be assigned manually in Viedoc Admin.